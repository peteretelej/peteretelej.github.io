---
title: Ubuntu VPS Setup Guide
subtitle: Setting up your Ubuntu server Â· VPS Management
publishDate: 2018-03-10
updatedDate: 2025-08-16
tags: [ubuntu, vps, sysadmin, docker, caddy, security]
thumbnail: https://peteretelej.github.io/images/logos/ubuntu-logo.png
---

import ExpandableSection from '../../components/react/ExpandableSection.tsx';
import NavigationPills from '../../components/NavigationPills.astro';

Step-by-step Ubuntu server setup and hardening guide.

<NavigationPills links={[
  { href: "#getting-a-vps", label: "Getting a VPS" },
  { href: "#accessing-your-vps", label: "Accessing VPS" },
  { href: "#managing-users", label: "Managing Users" },
  { href: "#ssh-lockdown", label: "SSH Lockdown" },
  { href: "#update-server", label: "Update Server" },
  { href: "#docker-setup", label: "Docker Setup" },
  { href: "#web-server", label: "Web Server" },
  { href: "#add-swap", label: "Add Swap" },
  { href: "#configuring-a-firewall", label: "Firewall" },
  { href: "#intrusion-prevention", label: "Intrusion Prevention" },
  { href: "#monitoring", label: "Monitoring" },
]} />

### Getting a VPS

You need a Linux VPS (Virtual Private Server) to follow this guide. Any Ubuntu LTS version works.

<ExpandableSection 
  title="VPS Provider Options"
  description="Some great VPS provider options are DigitalOcean, Hetzner, Linode, Vultr."
  buttonText="See provider details"
  client:load>

- **[Hetzner Cloud](https://www.hetzner.com/cloud)** - Best value for money. Excellent hardware specs, includes generous traffic allowances. Limited to fewer regions than other VPS providers. Their [server auction](https://www.hetzner.com/sb/) offers dedicated hardware at cheap, transparent pricing.

- **[DigitalOcean](https://m.do.co/c/30b582135eb7)** - Solid choice with good documentation and 14+ global regions. Pricing is middle-tier but you get reliable performance and excellent tutorials.

- **[Linode](https://www.linode.com/)** - Consistent performance and responsive support. Good balance of features and pricing. Strong reputation in the developer community.

- **[Vultr](https://www.vultr.com/)** - Good global coverage with competitive pricing. Interface is straightforward, performance is reliable.

- **[AWS Lightsail](https://aws.amazon.com/lightsail/)** - If you're already in the AWS ecosystem. More expensive but integrates well with other AWS services.

- For most other _"cheap VPS"_, I recommend caution. They often have hidden costs, poor support, or unreliable performance.

</ExpandableSection>

### Accessing Your VPS

After creating a VPS instance (for example your DigitalOcean [droplet](https://m.do.co/c/30b582135eb7)), you will be provided an IP address as well as login password. Use the credentials to log into the server.

```sh
ssh root@SERVER_IP_ADDRESS
```


### Managing Users

By default, only one user exists: **root** - a superuser 

#### Creating a new user

Create a new user to avoid using root and it's elevated privileges. While creating a new user, several questions will be asked. You can add additional information about the user but note that only the password is essential.( Press ENTER to skip the rest)

```sh
adduser demouser

# you can now give the user access to root privileges (sudo) 
gpasswd -a demouser sudo
```

**Confirm that you can login as this new user** before proceeding.

```sh
ssh newuser@SERVER_IP

sudo su - # try to access root as user
```

### SSH Lockdown

#### Disabling root login

Before disabling root login, ensure that you've created a user that can SSH to the server _(as explained in [User Management](#managing-users) section above)_.
The user can use the `su` command to become root (will need root password), or if the user has sudo they can just `sudo su -` to access root.

Edit `/etc/ssh/sshd_config` and turn **PermitRootLogin** to **no**. Use a different editor if new to **vi** (ZZ to exit).

> **Warning:** Before doing this, ensure that you can login with another (non-root) user account (see [Managing Users](#managing-users) above).

```sh
sudo vi /etc/ssh/sshd_config

# Change the following line
PermitRootLogin yes
# to
PermitRootLogin no
```

Restart ssh service for this change to effect.

```sh
sudo systemctl restart sshd
```

<ExpandableSection 
  title="SSH Key-Based Authentication" 
  description="You can also setup <b>public key authentication</b> (recommended). This will enable you to securely login to the server without having to enter your password."
  client:load>

#### Public Key Authentication

Public Key authentication enables you to login to a server using ssh public key. This is my **recommended** method of authentication.

SSH Keys come in a pair; a **private** and **public** key.

##### Generate Key Pair

OpenSSH client is required, this is most likely already installed. You can install it with `sudo apt-get -y install openssh-client`

#### Generate Ed25519 Keys (Recommended)

Ed25519 provides strong security with smaller keys and fast performance.

```sh
ssh-keygen -t ed25519 -C "your_email@example.com"
```

For systems that don't support Ed25519, use RSA with 4096 bits:

```sh
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

The public and private keys will be generated in **~/.ssh/** as **id_ed25519.pub** and **id_ed25519** respectively (or **id_rsa.pub** and **id_rsa** for RSA). The public key can safely be shared, however, NEVER share your private key.

In order to login with the generate ssh keys, append the contents of the public key to the following file in the VPS **~/.ssh/authorized_keys**.

From your computer, you can run either of the following commands. They will require inputting your password once.

```sh
# ssh-copy-id is an command that copies the public key automatically
ssh-copy-id USERNAME@SERVER_IP

# manually copy the public file (one-line)
ssh USERNAME@SERVER_IP "echo \"$(cat ~/.ssh/id_rsa.pub)\" >> .ssh/authorized_keys"
```

You can now simply login without entering a password with `ssh USERNAME@SERVER_IP`.

Disable Password Authentication _(Optional)_: Edit `/etc/ssh/sshd_config` 

```sh
sudo vi /etc/ssh/sshd_config

# Security settings
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
ChallengeResponseAuthentication no
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2

# Modern crypto only (comment out for older systems)
HostKey /etc/ssh/ssh_host_ed25519_key
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com
```

Restart ssh service

```sh
sudo systemctl reload sshd
```

</ExpandableSection>

<ExpandableSection 
  title="Using a custom SSH Port"
  description="I would also recommend using a <b>non-common port for SSH</b>."
  client:load>

#### Using a custom SSH Port

Edit `/etc/ssh/sshd_config` and change the **Port** number to a non-common SSH port (just pick an unused number more that 1025, note: don't use 2222, it's also common)

```sh
sudo vi /etc/ssh/sshd_config

# Uncomment and change Port number from 
# Port 22
# to 
Port 2222

# Restart ssh daemon service
sudo systemctl restart sshd
```

</ExpandableSection>

### Update Server

- Update server software:
```sh
sudo apt-get update && sudo apt-get upgrade -y
```

- Set desired server hostname: As superuser, edit the files `/etc/hostname` and `/etc/hosts`. To update without a restart restart, run this: `systemctl restart systemd-logind.service`
- Update the timezone, to your desired timezone. Use `dpkg-reconfigure tzdata`

### Docker Setup

#### Docker Installation

Follow the official installation guide: [Install Docker Engine on Ubuntu](https://docs.docker.com/engine/install/ubuntu/)

Add your user to docker group to avoid using sudo:

```sh
sudo usermod -aG docker $USER
# Log out and back in for group changes to take effect
```

#### Configure Docker Security

Edit `/etc/docker/daemon.json`:

```json
{
  "icc": false,
  "userland-proxy": false,
  "no-new-privileges": true,
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

Restart Docker to apply configuration:

```sh
sudo systemctl restart docker
```

<ExpandableSection 
  title="Docker Rootless Mode"
  description="Run Docker without root privileges using rootless mode for additional security isolation."
  client:load>

#### Installation

Install rootless Docker:

```sh
# Install rootless Docker
curl -fsSL https://get.docker.com/rootless | sh

# Add to PATH
echo 'export PATH=$HOME/bin:$PATH' >> ~/.bashrc
echo 'export DOCKER_HOST=unix://$XDG_RUNTIME_DIR/docker.sock' >> ~/.bashrc
source ~/.bashrc

# Enable systemd service for current user
systemctl --user enable docker
systemctl --user start docker
```

**Benefits:**
- Docker daemon runs as regular user
- No need for sudo privileges
- Additional isolation from host system
- Reduced attack surface

**Limitations:**
- Cannot bind to privileged ports (< 1024)
- Some networking features limited
- Performance overhead for certain workloads

</ExpandableSection>

### Web Server

#### Caddy (Recommended)

Caddy provides automatic HTTPS without complex configuration.

Install Caddy: [Installation Guide](https://caddyserver.com/docs/install)

Basic configuration in `/etc/caddy/Caddyfile`:

```nginx
example.com {
    root * /var/www/example.com
    file_server
    encode gzip
}

# Reverse proxy with automatic HTTPS
api.example.com {
    reverse_proxy localhost:8080
}
```

Start and enable Caddy:

```sh
sudo systemctl enable --now caddy
```

> **Note:** Caddy obtains and renews SSL certificates automatically. No certbot needed.

<ExpandableSection 
  title="Nginx Configuration"
  description="Use nginx with Let's Encrypt certificates if you prefer traditional web server setup."
  client:load>

#### Installation

Install nginx:

```sh
sudo apt install nginx
```

Basic site configuration in `/etc/nginx/sites-available/example.com`:

```nginx
server {
    listen 80;
    server_name example.com www.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com www.example.com;
    
    root /var/www/example.com;
    index index.html index.php;
    
    # SSL configuration (use certbot)
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Reverse proxy example
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

Enable site and restart nginx:

```sh
sudo ln -s /etc/nginx/sites-available/example.com /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

Install certbot for SSL:

```sh
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d example.com -d www.example.com
```

</ExpandableSection>

### Add Swap

Check if swap is already enabled on the server, if enabled, the swap partition will be listed.

```sh
sudo swapon -s 

# alternatively 
free -g
# shows free (and used) physical & swap memory (-g = in gb)
```

If swap is not enabled, check the amount disk space you have available.

```sh
df -h
```

Create swapfile (usu 2x or 1x your RAM)

```sh
# Fast Method (fallocate e.g creating 1gb swap)
sudo fallocate -l 1G /swapfile

# Slow method (e.g creating 4gb swap)
### sudo dd if=/dev/zero of=/swapfile bs=1G count=4
```

Verify space has been allocated

```sh
ls -lh /swapfile
```

Enable Swap

```sh
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

#verify it's enabled
sudo swapon -s
```

Enable Swap on Reboot/ Start: Edit fstab (`/etc/fstab`), and add the swap filesystem.

```sh
sudo vi /etc/fstab

# Add this line to /etc/fstab
/swapfile   none    swap    sw    0   0
```

<ExpandableSection 
  title="Tweak Swappiness"
  description="If you are working on a RAM intensive app, e.g Java, consider <b>reducing swappiness</b> and <b>inode cache rate</b>."
  client:load>

#### Tweak Swappiness

Check the current swappiness (0-100)

```sh
cat /proc/sys/vm/swappiness 
# default is usually 60
```

Change swappiness to your desired value.

```sh
sudo sysctl vm.swappiness=20
```

Enable on restarts

```sh
sudo vi /etc/sysctl.conf

# Add this line to /etc/sysctl.conf
vm.swappiness=10
```

#### Inode Cache Rate

```sh
# Check the current inode cache rate
cat /proc/sys/vm/vfs_cache_pressure #usu 60

# Change to desired value
sudo sysctl vm.vfs_cache_pressure=50

# Add to restarts
sudo vi /etc/sysctl.conf

# Add this line to /etc/sysctl.conf
vm.vfs_cache_pressure = 50
```

</ExpandableSection>

### Configuring a Firewall

**UFW** _(uncomplicated firewall)_ is a tool that simplifies configuring of `iptables` to secure your server. It is an easy to use firewall.

Install **ufw** (most likely already installed)

```sh
sudo apt-get install ufw
```

Enable IPv6: Edit `/etc/default/ufw` and set IPv6=yes

```sh
sudo vi /etc/default/ufw 

# set
IPv6=yes
```

Check ufw status and rules (will be inactive if not yet enabled).

```sh
sudo ufw status verbose
```

Setup default firewall policies

```sh
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

##### Allow **common connections** only allow what you use

Allowing SSH connection (default ssh port 22)

```sh
sudo ufw allow ssh
# same as: sudo ufw allow 22/tcp 
```

If you are using different port for SSH (see [SSH Lockdown: custom port](#ssh-lockdown) above), then allow that instead of port 22

```sh
sudo ufw allow 2222/tcp
```

Allow HTTP and HTTPS

```sh
sudo ufw allow http
sudo ufw allow https

# the above two commands are the same as                                   
sudo ufw allow 80/tcp                
sudo ufw allow 443/tcp               
```

Allow SMTP - if sending out mail directly using SMTP

```sh
sudo ufw allow 25/tcp
```

Check all added exceptions (allowed connections)

```sh
sudo ufw show added
```

Enable UFW: Also useful when reloading to update configuration

```sh
sudo ufw disable
sudo ufw enable
```

##### Reset UFW

In case of errors during configuration, you can reset `ufw` with the following command

```sh
sudo ufw reset
```

<ExpandableSection 
  title="UFW Docker Fix"
  description="UFW and <b>docker</b>: Docker usually manipulates <code>iptables</code> rules meaning that the ufw restrictions will not apply."
  client:load>

Here are a few workarounds I've found useful. You can either:

1. Only bind docker containers to loopback interfaces e.g. `docker run -p "127.0.0.1:8080:80"`.. 
2. Not use port forwarding (`-p` or `-P`) esp. if you don't need it.
3. Add `--iptables=false` to the docker daemon: Uncomment the following line in `/etc/default/docker`
```sh
DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4 --iptables=false"                 
```
Restart the docker service for the change to effect ` sudo systemctl restart docker`
4. Use the host's network `docker run --net host`..

</ExpandableSection>

### Intrusion Prevention

#### CrowdSec (Recommended)

CrowdSec provides community-driven threat intelligence.

Install CrowdSec:

```sh
curl -s https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.deb.sh | sudo bash
sudo apt update
sudo apt install crowdsec
```

CrowdSec automatically detects services and shares threat data while maintaining privacy.

Start and enable CrowdSec:

```sh
sudo systemctl enable --now crowdsec
```

Install the firewall bouncer to automatically block detected IPs:

```sh
sudo apt install crowdsec-firewall-bouncer-iptables
```

View current detections and bans:

```sh
sudo cscli decisions list
sudo cscli alerts list
```

<ExpandableSection 
  title="CrowdSec vs Fail2ban"
  description="CrowdSec provides community threat intelligence while fail2ban works with local patterns."
  buttonText="See comparison"
  client:load>

#### Key Advantages

**Community Intelligence:**
- Each instance contributes to global threat detection
- Shared indicators updated in real-time
- Collective learning from attack patterns

**Machine Learning:**
- Identifies behavioral patterns regex-based systems miss
- Adapts to new attack vectors automatically
- Reduces false positives through smart analysis

**API Integration:**
- Works with CDNs (Cloudflare, AWS WAF)
- Integrates with cloud firewalls
- Supports custom bouncers for any platform

**Privacy-First:**
- Shares hashed indicators, not raw IPs
- No personal data transmission
- Local decision making with global intelligence

#### Migration from fail2ban

If you have fail2ban installed:

```sh
# Stop and disable fail2ban
sudo systemctl stop fail2ban
sudo systemctl disable fail2ban

# CrowdSec automatically handles similar scenarios
# No complex jail configuration needed
```

</ExpandableSection>

#### Fail2ban (Alternative)

For environments that prefer fail2ban:

```sh
sudo apt install fail2ban
```

Basic SSH protection in `/etc/fail2ban/jail.local`:

```ini
[DEFAULT]
bantime = 1800
findtime = 600
maxretry = 3
ignoreip = 127.0.0.1/8

[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
```

Enable and start:

```sh
sudo systemctl enable --now fail2ban
```

> **Note:** While both solutions help reduce invalid login attempts, they don't eliminate the need for strong authentication. Use SSH key authentication as described above.

### Monitoring

#### Quick Setup with Netdata

One-line installation for immediate system insights:

```sh
bash <(curl -Ss https://my-netdata.io/kickstart.sh)
```

Access at `http://your-server:19999` - no configuration needed.

**What you get:**
- Real-time system metrics (CPU, memory, disk, network)
- Application monitoring (web servers, databases)
- Alert notifications
- Beautiful, responsive web interface

Configure firewall for Netdata:

```sh
sudo ufw allow 19999/tcp
```

<ExpandableSection 
  title="Advanced Monitoring Stack"
  description="Use Prometheus + Grafana for custom dashboards, metrics collection, and advanced alerting."
  client:load>

#### Setup Process

Install Prometheus:

```sh
sudo useradd --no-create-home --shell /bin/false prometheus
sudo mkdir /etc/prometheus /var/lib/prometheus
sudo chown prometheus:prometheus /etc/prometheus /var/lib/prometheus

wget https://github.com/prometheus/prometheus/releases/download/v2.40.0/prometheus-2.40.0.linux-amd64.tar.gz
tar xvfz prometheus-2.40.0.linux-amd64.tar.gz
sudo cp prometheus-2.40.0.linux-amd64/prometheus /usr/local/bin/
sudo cp prometheus-2.40.0.linux-amd64/promtool /usr/local/bin/
sudo chown prometheus:prometheus /usr/local/bin/prometheus /usr/local/bin/promtool
```

Basic Prometheus config in `/etc/prometheus/prometheus.yml`:

```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
  
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
```

Install node_exporter for system metrics:

```sh
wget https://github.com/prometheus/node_exporter/releases/download/v1.4.0/node_exporter-1.4.0.linux-amd64.tar.gz
tar xvfz node_exporter-1.4.0.linux-amd64.tar.gz
sudo cp node_exporter-1.4.0.linux-amd64/node_exporter /usr/local/bin/
sudo useradd --no-create-home --shell /bin/false node_exporter
sudo chown node_exporter:node_exporter /usr/local/bin/node_exporter
```

Create systemd services and enable them. For detailed setup, see [Prometheus documentation](https://prometheus.io/docs/introduction/getting_started/).

</ExpandableSection>

---

#### Relevant Guides & Tutorials

Helpful resources for further reading and advanced configurations:

##### Official Documentation
- [Ubuntu Server Guide - Security](https://ubuntu.com/server/docs/security-introduction)
- [SSH Hardening Guides](https://www.sshaudit.com/hardening_guides.html)
- [OWASP Docker Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)

##### Comprehensive Security Guides
- [Ubuntu System Hardening Guide](https://linux-audit.com/system-hardening/guides/ubuntu/) - Linux Audit
- [40 Linux Server Hardening Security Tips](https://www.cyberciti.biz/tips/linux-security.html) - nixCraft
- [Ubuntu 24.04 LTS Initial Setup & Hardening](https://gist.github.com/jeanpauldejong/1274c87ce0ae0c8e27443437a5b575ea) - Community Gist

##### DigitalOcean Community Tutorials
- [Initial Server Setup with Ubuntu](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu)
- [How to Set Up a Firewall with UFW on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu)
- [UFW Essentials: Common Firewall Rules and Commands](https://www.digitalocean.com/community/tutorials/ufw-essentials-common-firewall-rules-and-commands)

##### Modern Security Practices
- [CrowdSec Documentation](https://docs.crowdsec.net/) - Community-driven intrusion prevention
- [Caddy Documentation](https://caddyserver.com/docs/) - Automatic HTTPS web server
- [Docker Security Best Practices](https://docs.docker.com/engine/security/) - Official Docker security guide


